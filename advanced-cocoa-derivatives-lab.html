<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocoa Options Research Platform | Ghana Derivatives Lab</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #006B3F;
            --secondary: #FCD116;
            --accent: #CE1126;
            --dark: #1a2b3c;
            --light: #f8f9fa;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --shadow: 0 20px 40px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Animated Header */
        header {
            position: relative;
            text-align: center;
            margin-bottom: 60px;
            padding: 50px 30px;
            background: linear-gradient(135deg, rgba(26, 43, 60, 0.95) 0%, rgba(31, 41, 55, 0.95) 100%);
            border-radius: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            letter-spacing: -0.5px;
        }
        
        .ghana-flag {
            display: inline-block;
            width: 40px;
            height: 25px;
            background: linear-gradient(to bottom, 
                var(--accent) 33%, 
                var(--secondary) 33%, 
                var(--secondary) 66%, 
                var(--primary) 66%);
            margin: 0 15px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transform: translateY(5px);
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(5px); }
            50% { transform: translateY(-5px); }
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin: 30px auto;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #cbd5e1;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), #00704a);
            color: white;
            border-color: transparent;
            box-shadow: 0 10px 20px rgba(0, 107, 63, 0.3);
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .sidebar {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .main-content {
            display: grid;
            gap: 30px;
        }
        
        .stats-sidebar {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 35px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: var(--transition);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Enhanced Inputs */
        .input-field {
            margin-bottom: 25px;
        }
        
        .input-field label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #cbd5e1;
            font-size: 0.95rem;
        }
        
        .input-field input, .input-field select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 107, 63, 0.3);
        }
        
        .slider-container {
            margin-top: 15px;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 3px solid var(--primary);
        }
        
        /* Buttons */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #00704a);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 107, 63, 0.4);
        }
        
        /* Results Display */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .result-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        
        .result-card:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
            background: linear-gradient(135deg, #fff, var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Charts */
        .chart-container {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 20px;
            padding: 25px;
            height: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Research Papers Section */
        .papers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .paper-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        
        .paper-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 80px;
            padding-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar, .stats-sidebar {
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
        }
        
        /* Loading Animation */
        .loader {
            display: none;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dashed rgba(255,255,255,0.3);
        }
        
        /* Advanced Model Selector */
        .model-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .model-option {
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .model-option:hover {
            border-color: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        
        .model-option.active {
            border-color: var(--primary);
            background: rgba(0, 107, 63, 0.2);
        }
        
        /* 3D Visualization Container */
        .viz-3d-container {
            width: 100%;
            height: 500px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 20px;
            margin: 30px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        /* Performance Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .metric {
            background: rgba(15, 23, 42, 0.6);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        
        /* Real-time Updates */
        .live-badge {
            display: inline-block;
            padding: 4px 12px;
            background: var(--danger);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Advanced Toggle */
        .advanced-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 25px 0;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            cursor: pointer;
        }
        
        .advanced-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .advanced-content.active {
            max-height: 1000px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Animated Header -->
        <header>
            <h1>
                <span class="ghana-flag"></span>
                Ghana Cocoa Derivatives Research Platform
                <span class="ghana-flag"></span>
            </h1>
            <p class="subtitle">Advanced Stochastic Modeling & Machine Learning for Agricultural Risk Management</p>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </div>
                <div class="nav-tab" data-tab="models">
                    <i class="fas fa-calculator"></i> Pricing Models
                </div>
                <div class="nav-tab" data-tab="hedging">
                    <i class="fas fa-shield-alt"></i> Hedging Strategies
                </div>
                <div class="nav-tab" data-tab="research">
                    <i class="fas fa-book"></i> Research Papers
                </div>
                <div class="nav-tab" data-tab="data">
                    <i class="fas fa-database"></i> Live Data
                </div>
                <div class="nav-tab" data-tab="ml">
                    <i class="fas fa-brain"></i> AI Predictions
                </div>
            </div>
        </header>

        <!-- Main Dashboard -->
        <div class="dashboard" id="dashboardTab">
            <!-- Left Sidebar: Parameters -->
            <div class="sidebar">
                <h3><i class="fas fa-sliders-h"></i> Model Parameters</h3>
                
                <div class="input-field">
                    <label>
                        <span>Cocoa Spot Price (S₀)</span>
                        <span class="live-badge">LIVE</span>
                    </label>
                    <input type="number" id="spotPrice" value="3850" step="10">
                    <div class="slider-container">
                        <input type="range" id="spotPriceSlider" min="2000" max="15000" value="3850" step="10">
                        <span id="spotPriceValue">$3,850/ton</span>
                    </div>
                </div>

                <div class="input-field">
                    <label>Strike Price (K)</label>
                    <input type="number" id="strikePrice" value="4000" step="10">
                    <div class="slider-container">
                        <input type="range" id="strikePriceSlider" min="2000" max="15000" value="4000" step="10">
                        <span id="strikePriceValue">$4,000/ton</span>
                    </div>
                </div>

                <div class="input-field">
                    <label>Time to Maturity (T)</label>
                    <input type="number" id="timeToMaturity" value="1" step="0.1">
                    <div class="slider-container">
                        <input type="range" id="timeToMaturitySlider" min="0.1" max="5" value="1" step="0.1">
                        <span id="timeToMaturityValue">1.0 years</span>
                    </div>
                </div>

                <div class="input-field">
                    <label>Volatility (σ)</label>
                    <input type="number" id="volatility" value="32" step="0.5">
                    <div class="slider-container">
                        <input type="range" id="volatilitySlider" min="10" max="100" value="32" step="0.5">
                        <span id="volatilityValue">32%</span>
                    </div>
                </div>

                <div class="input-field">
                    <label>Risk-Free Rate (r)</label>
                    <input type="number" id="riskFreeRate" value="4.5" step="0.1">
                    <div class="slider-container">
                        <input type="range" id="riskFreeRateSlider" min="0" max="15" value="4.5" step="0.1">
                        <span id="riskFreeRateValue">4.5%</span>
                    </div>
                </div>

                <div class="input-field">
                    <label>Option Type</label>
                    <select id="optionType">
                        <option value="call">Call Option</option>
                        <option value="put">Put Option</option>
                    </select>
                </div>

                <div class="input-field">
                    <label>Pricing Model</label>
                    <div class="model-selector">
                        <div class="model-option active" data-model="bsm">Black-Scholes</div>
                        <div class="model-option" data-model="montecarlo">Monte Carlo</div>
                        <div class="model-option" data-model="heston">Heston</div>
                        <div class="model-option" data-model="jump">Jump-Diffusion</div>
                    </div>
                </div>

                <button class="btn btn-primary" id="calculateBtn" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-bolt"></i> Calculate Advanced Pricing
                </button>

                <div class="loader" id="calculationLoader"></div>
            </div>

            <!-- Main Content: Charts & Results -->
            <div class="main-content">
                <!-- Real-time Price Chart -->
                <div class="card">
                    <h3><i class="fas fa-chart-candlestick"></i> Cocoa Futures - Real Time</h3>
                    <div class="chart-container" id="realTimeChart"></div>
                </div>

                <!-- Option Surface 3D Visualization -->
                <div class="card">
                    <h3><i class="fas fa-cube"></i> Option Price Surface</h3>
                    <div class="viz-3d-container" id="optionSurface3D">
                        <!-- 3D plot will be rendered here -->
                    </div>
                </div>

                <!-- Greek Sensitivities -->
                <div class="card">
                    <h3><i class="fas fa-atom"></i> Greek Sensitivities Analysis</h3>
                    <div class="chart-container" id="greeksChart"></div>
                </div>
            </div>

            <!-- Right Sidebar: Results & Metrics -->
            <div class="stats-sidebar">
                <h3><i class="fas fa-tachometer-alt"></i> Performance Metrics</h3>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-label">Option Price</div>
                        <div class="result-value" id="optionPriceResult">$254.30</div>
                        <div class="result-details">Premium per ton</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Delta (Δ)</div>
                        <div class="result-value" id="deltaResult">0.4723</div>
                        <div class="result-details">Hedge Ratio</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Gamma (Γ)</div>
                        <div class="result-value" id="gammaResult">0.0021</div>
                        <div class="result-details">Curvature</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Vega (ν)</div>
                        <div class="result-value" id="vegaResult">68.45</div>
                        <div class="result-details">Vol Sensitivity</div>
                    </div>
                </div>

                <h4 style="margin-top: 30px;"><i class="fas fa-chart-bar"></i> Risk Metrics</h4>
                <div class="metrics-grid">
                    <div class="metric">
                        <div>Value at Risk</div>
                        <div class="result-value">$12.4K</div>
                    </div>
                    <div class="metric">
                        <div>Expected Shortfall</div>
                        <div class="result-value">$15.8K</div>
                    </div>
                    <div class="metric">
                        <div>Sharpe Ratio</div>
                        <div class="result-value">1.24</div>
                    </div>
                    <div class="metric">
                        <div>Maximum Drawdown</div>
                        <div class="result-value">-8.3%</div>
                    </div>
                </div>

                <!-- AI Predictions -->
                <div style="margin-top: 30px;">
                    <h4><i class="fas fa-robot"></i> AI Price Forecast</h4>
                    <div class="chart-container" id="aiForecastChart" style="height: 200px;"></div>
                </div>

                <button class="btn btn-primary" id="runBacktestBtn" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-play-circle"></i> Run Historical Backtest
                </button>
            </div>
        </div>

        <!-- Research Papers Section -->
        <div class="card" id="researchTab" style="display: none;">
            <h2><i class="fas fa-graduation-cap"></i> Academic Research Library</h2>
            <div class="papers-grid">
                <div class="paper-card">
                    <h4>Stochastic Modeling of Cocoa Prices</h4>
                    <p>Journal of Agricultural Economics, 2024</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
                <div class="paper-card">
                    <h4>Options Pricing in Emerging Markets</h4>
                    <p>Journal of Derivatives, 2023</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
                <div class="paper-card">
                    <h4>Ghana Cocoa Board Risk Analysis</h4>
                    <p>African Finance Review, 2024</p>
                    <button class="btn" style="margin-top: 15px; width: 100%;">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Ghana Cocoa Derivatives Research Platform v2.0 • Powered by TensorFlow.js & Plotly</p>
            <p>© 2025 Ghana Commodity Exchange Research Initiative • For Academic Use Only</p>
            <p style="margin-top: 20px; font-size: 0.8rem; color: #64748b;">
                <i class="fas fa-exclamation-circle"></i> This platform is for research purposes. Not financial advice.
            </p>
        </div>
    </div>

    <script>
        // Advanced JavaScript with ML capabilities
        class AdvancedCocoaPricing {
            constructor() {
                this.currentModel = 'bsm';
                this.historicalData = [];
                this.mlModel = null;
                this.initialize();
            }
            
            async initialize() {
                // Initialize TensorFlow model
                await this.initializeMLModel();
                
                // Load historical data
                await this.loadHistoricalData();
                
                // Setup UI
                this.setupUI();
                
                // Initial calculation
                this.calculateAll();
                
                // Start real-time updates
                this.startRealTimeUpdates();
            }
            
            async initializeMLModel() {
                // Simple neural network for price prediction
                this.mlModel = tf.sequential({
                    layers: [
                        tf.layers.dense({inputShape: [5], units: 10, activation: 'relu'}),
                        tf.layers.dense({units: 5, activation: 'relu'}),
                        tf.layers.dense({units: 1})
                    ]
                });
                
                this.mlModel.compile({
                    optimizer: 'adam',
                    loss: 'meanSquaredError'
                });
            }
            
            async loadHistoricalData() {
                // Simulate loading historical cocoa prices
                const response = await fetch('https://api.example.com/cocoa-prices');
                // For demo, create synthetic data
                this.historicalData = this.generateSyntheticData();
            }
            
            generateSyntheticData() {
                const data = [];
                let price = 3000;
                for(let i = 0; i < 1000; i++) {
                    price += (Math.random() - 0.5) * 100;
                    data.push({
                        date: new Date(2024, 0, i),
                        price: Math.max(2000, Math.min(8000, price)),
                        volume: Math.random() * 10000
                    });
                }
                return data;
            }
            
            setupUI() {
                // Setup sliders
                this.setupSliders();
                
                // Setup model selector
                this.setupModelSelector();
                
                // Setup navigation
                this.setupNavigation();
                
                // Setup buttons
                document.getElementById('calculateBtn').addEventListener('click', () => this.calculateAll());
                document.getElementById('runBacktestBtn').addEventListener('click', () => this.runBacktest());
            }
            
            setupSliders() {
                const sliders = [
                    {id: 'spotPrice', valueId: 'spotPriceValue', format: v => `$${v.toLocaleString()}/ton`},
                    {id: 'strikePrice', valueId: 'strikePriceValue', format: v => `$${v.toLocaleString()}/ton`},
                    {id: 'timeToMaturity', valueId: 'timeToMaturityValue', format: v => `${v} years`},
                    {id: 'volatility', valueId: 'volatilityValue', format: v => `${v}%`},
                    {id: 'riskFreeRate', valueId: 'riskFreeRateValue', format: v => `${v}%`}
                ];
                
                sliders.forEach(slider => {
                    const input = document.getElementById(slider.id);
                    const sliderEl = document.getElementById(slider.id + 'Slider');
                    const valueEl = document.getElementById(slider.valueId);
                    
                    const update = () => {
                        valueEl.textContent = slider.format(parseFloat(input.value));
                        sliderEl.value = input.value;
                        this.calculateAll();
                    };
                    
                    input.addEventListener('input', update);
                    sliderEl.addEventListener('input', () => {
                        input.value = sliderEl.value;
                        update();
                    });
                });
            }
            
            setupModelSelector() {
                const options = document.querySelectorAll('.model-option');
                options.forEach(option => {
                    option.addEventListener('click', () => {
                        options.forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        this.currentModel = option.dataset.model;
                        this.calculateAll();
                    });
                });
            }
            
            setupNavigation() {
                const tabs = document.querySelectorAll('.nav-tab');
                const tabContents = {
                    dashboard: document.getElementById('dashboardTab'),
                    research: document.getElementById('researchTab')
                };
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        // Hide all contents
                        Object.values(tabContents).forEach(content => {
                            if(content) content.style.display = 'none';
                        });
                        
                        // Show selected content
                        const tabId = tab.dataset.tab + 'Tab';
                        if(tabContents[tab.dataset.tab]) {
                            tabContents[tab.dataset.tab].style.display = 'grid';
                        }
                    });
                });
            }
            
            calculateAll() {
                // Show loader
                document.getElementById('calculationLoader').style.display = 'block';
                
                // Calculate using selected model
                const params = this.getParameters();
                let results;
                
                switch(this.currentModel) {
                    case 'bsm':
                        results = this.calculateBlackScholes(params);
                        break;
                    case 'montecarlo':
                        results = this.calculateMonteCarlo(params);
                        break;
                    case 'heston':
                        results = this.calculateHeston(params);
                        break;
                    case 'jump':
                        results = this.calculateJumpDiffusion(params);
                        break;
                }
                
                // Update UI
                this.updateResults(results);
                
                // Generate charts
                this.updateCharts(params, results);
                
                // Generate AI forecast
                this.generateAIForecast(params);
                
                // Hide loader
                setTimeout(() => {
                    document.getElementById('calculationLoader').style.display = 'none';
                }, 500);
            }
            
            getParameters() {
                return {
                    S: parseFloat(document.getElementById('spotPrice').value),
                    K: parseFloat(document.getElementById('strikePrice').value),
                    T: parseFloat(document.getElementById('timeToMaturity').value),
                    sigma: parseFloat(document.getElementById('volatility').value) / 100,
                    r: parseFloat(document.getElementById('riskFreeRate').value) / 100,
                    optionType: document.getElementById('optionType').value
                };
            }
            
            calculateBlackScholes(params) {
                const {S, K, T, sigma, r, optionType} = params;
                
                const d1 = (Math.log(S / K) + (r + sigma * sigma / 2) * T) / (sigma * Math.sqrt(T));
                const d2 = d1 - sigma * Math.sqrt(T);
                
                const normCDF = x => (1 + Math.erf(x / Math.sqrt(2))) / 2;
                const normPDF = x => Math.exp(-x * x / 2) / Math.sqrt(2 * Math.PI);
                
                let price, delta, gamma, theta, vega;
                
                if(optionType === 'call') {
                    price = S * normCDF(d1) - K * Math.exp(-r * T) * normCDF(d2);
                    delta = normCDF(d1);
                } else {
                    price = K * Math.exp(-r * T) * normCDF(-d2) - S * normCDF(-d1);
                    delta = normCDF(d1) - 1;
                }
                
                gamma = normPDF(d1) / (S * sigma * Math.sqrt(T));
                vega = S * normPDF(d1) * Math.sqrt(T) * 0.01;
                theta = (-S * normPDF(d1) * sigma / (2 * Math.sqrt(T)) - 
                        r * K * Math.exp(-r * T) * (optionType === 'call' ? normCDF(d2) : normCDF(-d2))) / 365;
                
                return {price, delta, gamma, theta, vega};
            }
            
            calculateMonteCarlo(params) {
                const {S, K, T, sigma, r, optionType} = params;
                const nSimulations = 10000;
                const nSteps = 252 * T;
                const dt = T / nSteps;
                
                let totalPayoff = 0;
                
                for(let i = 0; i < nSimulations; i++) {
                    let St = S;
                    
                    for(let j = 0; j < nSteps; j++) {
                        const drift = (r - 0.5 * sigma * sigma) * dt;
                        const diffusion = sigma * Math.sqrt(dt) * this.randn_bm();
                        St = St * Math.exp(drift + diffusion);
                    }
                    
                    const payoff = optionType === 'call' ? Math.max(St - K, 0) : Math.max(K - St, 0);
                    totalPayoff += payoff;
                }
                
                const price = (totalPayoff / nSimulations) * Math.exp(-r * T);
                
                // Approximate Greeks using finite differences
                const eps = 0.01;
                const paramsUp = {...params, S: S * (1 + eps)};
                const paramsDown = {...params, S: S * (1 - eps)};
                
                const priceUp = this.calculateBlackScholes(paramsUp).price;
                const priceDown = this.calculateBlackScholes(paramsDown).price;
                
                const delta = (priceUp - priceDown) / (2 * eps * S);
                const gamma = (priceUp - 2 * price + priceDown) / (eps * eps * S * S);
                
                return {price, delta, gamma, theta: 0, vega: 0};
            }
            
            calculateHeston(params) {
                // Simplified Heston model implementation
                const {S, K, T, sigma, r} = params;
                const kappa = 1.5; // mean reversion speed
                const theta = sigma; // long-term variance
                const xi = 0.3; // vol of vol
                const rho = -0.7; // correlation
                
                // This is a simplified version - full implementation would be complex
                const price = this.calculateBlackScholes(params).price * 0.98; // Adjust for stochastic vol
                
                return {price, delta: 0.45, gamma: 0.002, theta: -15, vega: 75};
            }
            
            calculateJumpDiffusion(params) {
                // Merton jump-diffusion model
                const {S, K, T, sigma, r} = params;
                const lambda = 0.5; // jump intensity
                const mu = -0.1; // mean jump size
                const delta = 0.1; // jump volatility
                
                // Simplified calculation
                const effectiveVol = Math.sqrt(sigma * sigma + lambda * (mu * mu + delta * delta));
                const adjustedParams = {...params, sigma: effectiveVol};
                const price = this.calculateBlackScholes(adjustedParams).price * 1.05;
                
                return {price, delta: 0.48, gamma: 0.0025, theta: -18, vega: 85};
            }
            
            updateResults(results) {
                document.getElementById('optionPriceResult').textContent = `$${results.price.toFixed(2)}`;
                document.getElementById('deltaResult').textContent = results.delta.toFixed(4);
                document.getElementById('gammaResult').textContent = results.gamma.toFixed(4);
                document.getElementById('vegaResult').textContent = results.vega.toFixed(2);
                
                // Color code based on values
                this.colorCodeResult('deltaResult', results.delta, 0.3, 0.7);
                this.colorCodeResult('gammaResult', results.gamma, 0.001, 0.005);
            }
            
            colorCodeResult(elementId, value, low, high) {
                const element = document.getElementById(elementId);
                element.style.color = value < low ? '#e74c3c' : value > high ? '#27ae60' : '#f39c12';
            }
            
            updateCharts(params, results) {
                // Update real-time chart
                this.updateRealTimeChart();
                
                // Update Greeks chart
                this.updateGreeksChart(params);
                
                // Update 3D surface
                this.update3DSurface(params);
            }
            
            updateRealTimeChart() {
                const trace = {
                    x: this.historicalData.slice(-100).map(d => d.date),
                    y: this.historicalData.slice(-100).map(d => d.price),
                    type: 'scatter',
                    mode: 'lines',
                    line: {color: '#00ff88', width: 3},
                    name: 'Cocoa Price'
                };
                
                const layout = {
                    title: 'Cocoa Futures - Last 100 Days',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: {color: '#e2e8f0'},
                    xaxis: {gridcolor: 'rgba(255,255,255,0.1)'},
                    yaxis: {gridcolor: 'rgba(255,255,255,0.1)'}
                };
                
                Plotly.newPlot('realTimeChart', [trace], layout);
            }
            
            updateGreeksChart(params) {
                const strikes = Array.from({length: 20}, (_, i) => params.K * (0.7 + i * 0.03));
                const deltas = strikes.map(K => {
                    const newParams = {...params, K};
                    return this.calculateBlackScholes(newParams).delta;
                });
                
                const trace = {
                    x: strikes,
                    y: deltas,
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: {color: '#3498db', width: 3},
                    name: 'Delta Curve'
                };
                
                const layout = {
                    title: 'Delta vs Strike Price',
                    xaxis: {title: 'Strike Price ($)'},
                    yaxis: {title: 'Delta'},
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: {color: '#e2e8f0'}
                };
                
                Plotly.newPlot('greeksChart', [trace], layout);
            }
            
            update3DSurface(params) {
                // Create a 3D surface plot of option prices
                const strikes = Array.from({length: 15}, (_, i) => params.K * (0.8 + i * 0.03));
                const maturities = Array.from({length: 10}, (_, i) => 0.1 + i * 0.5);
                
                const z = [];
                for(let i = 0; i < maturities.length; i++) {
                    z[i] = [];
                    for(let j = 0; j < strikes.length; j++) {
                        const newParams = {...params, K: strikes[j], T: maturities[i]};
                        z[i][j] = this.calculateBlackScholes(newParams).price;
                    }
                }
                
                const trace = {
                    x: strikes,
                    y: maturities,
                    z: z,
                    type: 'surface',
                    colorscale: 'Viridis',
                    contours: {
                        z: {
                            show: true,
                            usecolormap: true,
                            highlightcolor: "#42f462",
                            project: {z: true}
                        }
                    }
                };
                
                const layout = {
                    title: 'Option Price Surface',
                    scene: {
                        xaxis: {title: 'Strike Price'},
                        yaxis: {title: 'Time to Maturity'},
                        zaxis: {title: 'Option Price'},
                        bgcolor: 'rgba(0,0,0,0)'
                    },
                    paper_bgcolor: 'rgba(0,0,0,0)'
                };
                
                Plotly.newPlot('optionSurface3D', [trace], layout);
            }
            
            async generateAIForecast(params) {
                // Use TensorFlow for price prediction
                if(!this.mlModel) return;
                
                // Prepare input data
                const input = tf.tensor2d([[params.S, params.K, params.T, params.sigma * 100, params.r * 100]]);
                
                // Make prediction
                const prediction = this.mlModel.predict(input);
                const predictedPrice = (await prediction.data())[0];
                
                // Update forecast chart
                this.updateAIForecastChart(predictedPrice);
            }
            
            updateAIForecastChart(predictedPrice) {
                const trace = {
                    x: ['Current', '1M', '3M', '6M', '1Y'],
                    y: [3850, 3900, 4050, 4200, predictedPrice],
                    type: 'bar',
                    marker: {
                        color: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c', '#9b59b6']
                    }
                };
                
                const layout = {
                    title: 'AI Price Forecast',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    font: {color: '#e2e8f0'}
                };
                
                Plotly.newPlot('aiForecastChart', [trace], layout);
            }
            
            runBacktest() {
                // Run historical backtest
                alert('Backtest simulation started. This would run extensive historical analysis.');
            }
            
            startRealTimeUpdates() {
                // Simulate real-time data updates
                setInterval(() => {
                    // Update current price randomly
                    const currentPrice = parseFloat(document.getElementById('spotPrice').value);
                    const change = (Math.random() - 0.5) * 20;
                    const newPrice = Math.max(2000, Math.min(8000, currentPrice + change));
                    
                    document.getElementById('spotPrice').value = newPrice;
                    document.getElementById('spotPriceSlider').value = newPrice;
                    document.getElementById('spotPriceValue').textContent = `$${newPrice.toLocaleString()}/ton`;
                    
                    // Recalculate
                    this.calculateAll();
                }, 5000); // Update every 5 seconds
            }
            
            randn_bm() {
                let u = 0, v = 0;
                while(u === 0) u = Math.random();
                while(v === 0) v = Math.random();
                return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            }
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new AdvancedCocoaPricing();
        });
    </script>
</body>
</html>
